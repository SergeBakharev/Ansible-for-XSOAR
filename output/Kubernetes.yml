category: IT Services
commonfields:
  id: Kubernetes
  version: -1
configuration:
- additionalinfo: Provide a URL for accessing the API.
  display: K8s Host URL
  name: host
  required: true
  type: 0
- additionalinfo: Provide a username for authenticating with the API.
  display: Username
  name: username
  required: false
  type: 0
- additionalinfo: Provide a password for authenticating with the API.
  display: Password
  name: password
  required: false
  type: 4
- additionalinfo: Token used to authenticate with the API.
  display: API Key
  name: api_key
  required: false
  type: 4
- additionalinfo: Allows connection when SSL certificates are not valid. Set to `false`
    when certificates are not trusted.
  defaultvalue: 'False'
  display: Validate Certs
  name: validate_certs
  required: true
  type: 8
description: Manage Kubernetes
detaileddescription: Only basic auth is supported
display: Kubernetes
image: data:image/png;base64,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
name: Kubernetes
script:
  commands:
  - arguments:
    - auto: PREDEFINED
      description: 'Whether to override the default patch merge approach with a specific
        type. By default, the strategic merge will typically be used.

        For example, Custom Resource Definitions typically aren''t updatable by the
        usual strategic merge. You may want to use `merge` if you see "strategic merge
        patch format is not supported"

        See `https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/#use-a-json-merge-patch-to-update-a-deployment`

        Requires openshift >= 0.6.2

        If more than one merge_type is given, the merge_types will be tried in order

        If openshift >= 0.6.2, this defaults to `[''strategic-merge'', ''merge'']`,
        which is ideal for using the same parameters on resource kinds that combine
        Custom Resources and built-in resources. For openshift < 0.6.2, the default
        is simply `strategic-merge`.

        mutually exclusive with `apply`'
      isArray: true
      name: merge_type
      predefined:
      - json
      - merge
      - strategic-merge
    - default: true
      defaultValue: 'False'
      description: 'Whether to wait for certain resource kinds to end up in the desired
        state. By default the module exits once Kubernetes has received the request

        Implemented for `state=present` for `Deployment`, `DaemonSet` and `Pod`, and
        for `state=absent` for all resource kinds.

        For resource kinds without an implementation, `wait` returns immediately unless
        `wait_condition` is set.'
      name: wait
    - default: true
      defaultValue: '5'
      description: Number of seconds to sleep between checks.
      name: wait_sleep
    - default: true
      defaultValue: '120'
      description: How long in seconds to wait for the resource to end up in the desired
        state. Ignored if `wait` is not set.
      name: wait_timeout
    - description: Specifies a custom condition on the status to wait for. Ignored
        if `wait` is not set or is set to False.
      name: wait_condition
    - description: how (if at all) to validate the resource definition against the
        kubernetes schema. Requires the kubernetes-validate python module and openshift
        >= 0.8.0
      name: validate
    - description: 'Whether to append a hash to a resource name for immutability purposes

        Applies only to ConfigMap and Secret resources

        The parameter will be silently ignored for other resource kinds

        The full definition of an object is needed to generate the hash - this means
        that deleting an object created with append_hash will only work if the same
        object is passed with state=absent (alternatively, just use state=absent with
        the name including the generated hash and append_hash=no)

        Requires openshift >= 0.7.2'
      name: append_hash
    - description: '`apply` compares the desired resource definition with the previously
        supplied resource definition, ignoring properties that are automatically generated

        `apply` works better with Services than ''force=yes''

        Requires openshift >= 0.9.2

        mutually exclusive with `merge_type`'
      name: apply
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: Determines if an object should be created, patched, or deleted.
        When set to `present`, an object will be created, if it does not already exist.
        If set to `absent`, an existing object will be deleted. If set to `present`,
        an existing object will be patched, if its attributes differ from those specified
        using `resource_definition` or `src`.
      name: state
      predefined:
      - absent
      - present
    - default: true
      defaultValue: 'False'
      description: If set to `yes`, and `state` is `present`, an existing object will
        be replaced.
      name: force
    - default: true
      defaultValue: v1
      description: Use to specify the API version. Use to create, delete, or discover
        an object without providing a full resource definition. Use in conjunction
        with `kind`, `name`, and `namespace` to identify a specific object. If `resource
        definition` is provided, the `apiVersion` from the `resource_definition` will
        override this option.
      name: api_version
    - description: Use to specify an object model. Use to create, delete, or discover
        an object without providing a full resource definition. Use in conjunction
        with `api_version`, `name`, and `namespace` to identify a specific object.
        If `resource definition` is provided, the `kind` from the `resource_definition`
        will override this option.
      name: kind
    - description: Use to specify an object name. Use to create, delete, or discover
        an object without providing a full resource definition. Use in conjunction
        with `api_version`, `kind` and `namespace` to identify a specific object.
        If `resource definition` is provided, the `metadata.name` value from the `resource_definition`
        will override this option.
      name: name
    - description: Use to specify an object namespace. Useful when creating, deleting,
        or discovering an object without providing a full resource definition. Use
        in conjunction with `api_version`, `kind`, and `name` to identify a specfic
        object. If `resource definition` is provided, the `metadata.namespace` value
        from the `resource_definition` will override this option.
      name: namespace
    - description: 'Provide a valid YAML definition (either as a string, list, or
        dict) for an object when creating or updating. NOTE: `kind`, `api_version`,
        `name`, and `namespace` will be overwritten by corresponding values found
        in the provided `resource_definition`.'
      name: resource_definition
    - description: Token used to authenticate with the API. Can also be specified
        via K8S_AUTH_API_KEY environment variable.
      name: api_key
    - description: Path to an existing Kubernetes config file. If not provided, and
        no other connection options are provided, the openshift client will attempt
        to load the default configuration file from `~/.kube/config.json`. Can also
        be specified via K8S_AUTH_KUBECONFIG environment variable.
      name: kubeconfig
    - description: The name of a context found in the config file. Can also be specified
        via K8S_AUTH_CONTEXT environment variable.
      name: context
    description: Manage Kubernetes (K8s) objects
    name: k8s_k8s
    outputs:
    - contextPath: Kubernetes.result.api_version
      description: The versioned schema of this representation of an object.
      type: string
    - contextPath: Kubernetes.result.kind
      description: Represents the REST resource this object represents.
      type: string
    - contextPath: Kubernetes.result.metadata
      description: Standard object metadata. Includes name, namespace, annotations,
        labels, etc.
    - contextPath: Kubernetes.result.spec
      description: Specific attributes of the object. Will vary based on the I(api_version)
        and I(kind).
    - contextPath: Kubernetes.result.status
      description: Current status details for the object.
    - contextPath: Kubernetes.result.items
      description: Returned only when multiple yaml documents are passed to src or
        resource_definition
    - contextPath: Kubernetes.result.duration
      description: elapsed time of task in seconds
      type: number
  - arguments:
    - default: true
      defaultValue: v1
      description: Use to specify the API version. in conjunction with `kind`, `name`,
        and `namespace` to identify a specific object.
      name: api_version
    - description: Use to specify an object model. Use in conjunction with `api_version`,
        `name`, and `namespace` to identify a specific object.
      name: kind
      required: true
    - description: Use to specify an object name.  Use in conjunction with `api_version`,
        `kind` and `namespace` to identify a specific object.
      name: name
    - description: Use to specify an object namespace. Use in conjunction with `api_version`,
        `kind`, and `name` to identify a specific object.
      name: namespace
    - description: List of label selectors to use to filter results
      name: label_selectors
    - description: List of field selectors to use to filter results
      name: field_selectors
    - description: Token used to authenticate with the API. Can also be specified
        via K8S_AUTH_API_KEY environment variable.
      name: api_key
    - description: Path to an existing Kubernetes config file. If not provided, and
        no other connection options are provided, the openshift client will attempt
        to load the default configuration file from `~/.kube/config.json`. Can also
        be specified via K8S_AUTH_KUBECONFIG environment variable.
      name: kubeconfig
    - description: The name of a context found in the config file. Can also be specified
        via K8S_AUTH_CONTEXT environment variable.
      name: context
    description: Describe Kubernetes (K8s) objects
    name: k8s_info
    outputs:
    - contextPath: Kubernetes.resources.api_version
      description: The versioned schema of this representation of an object.
      type: string
    - contextPath: Kubernetes.resources.kind
      description: Represents the REST resource this object represents.
      type: string
    - contextPath: Kubernetes.resources.metadata
      description: Standard object metadata. Includes name, namespace, annotations,
        labels, etc.
    - contextPath: Kubernetes.resources.spec
      description: Specific attributes of the object. Will vary based on the I(api_version)
        and I(kind).
    - contextPath: Kubernetes.resources.status
      description: Current status details for the object.
  - arguments:
    - default: true
      defaultValue: v1
      description: Use to specify the API version. Use to create, delete, or discover
        an object without providing a full resource definition. Use in conjunction
        with `kind`, `name`, and `namespace` to identify a specific object. If `resource
        definition` is provided, the `apiVersion` from the `resource_definition` will
        override this option.
      name: api_version
    - description: Use to specify an object model. Use to create, delete, or discover
        an object without providing a full resource definition. Use in conjunction
        with `api_version`, `name`, and `namespace` to identify a specific object.
        If `resource definition` is provided, the `kind` from the `resource_definition`
        will override this option.
      name: kind
    - description: Use to specify an object name. Use to create, delete, or discover
        an object without providing a full resource definition. Use in conjunction
        with `api_version`, `kind` and `namespace` to identify a specific object.
        If `resource definition` is provided, the `metadata.name` value from the `resource_definition`
        will override this option.
      name: name
    - description: Use to specify an object namespace. Useful when creating, deleting,
        or discovering an object without providing a full resource definition. Use
        in conjunction with `api_version`, `kind`, and `name` to identify a specfic
        object. If `resource definition` is provided, the `metadata.namespace` value
        from the `resource_definition` will override this option.
      name: namespace
    - description: Token used to authenticate with the API. Can also be specified
        via K8S_AUTH_API_KEY environment variable.
      name: api_key
    - description: Path to an existing Kubernetes config file. If not provided, and
        no other connection options are provided, the openshift client will attempt
        to load the default configuration file from `~/.kube/config.json`. Can also
        be specified via K8S_AUTH_KUBECONFIG environment variable.
      name: kubeconfig
    - description: The name of a context found in the config file. Can also be specified
        via K8S_AUTH_CONTEXT environment variable.
      name: context
    - description: 'Provide a valid YAML definition (either as a string, list, or
        dict) for an object when creating or updating. NOTE: `kind`, `api_version`,
        `name`, and `namespace` will be overwritten by corresponding values found
        in the provided `resource_definition`.'
      name: resource_definition
    - description: The desired number of replicas.
      name: replicas
    - description: For Deployment, ReplicaSet, Replication Controller, only scale,
        if the number of existing replicas matches. In the case of a Job, update parallelism
        only if the current parallelism value matches.
      name: current_replicas
    - description: Only attempt to scale, if the current object version matches.
      name: resource_version
    - default: true
      defaultValue: 'True'
      description: For Deployment, ReplicaSet, Replication Controller, wait for the
        status value of `ready_replicas` to change to the number of `replicas`. In
        the case of a Job, this option is ignored.
      name: wait
    - default: true
      defaultValue: '20'
      description: When `wait` is `True`, the number of seconds to wait for the `ready_replicas`
        status to equal  `replicas`. If the status is not reached within the allotted
        time, an error will result. In the case of a Job, this option is ignored.
      name: wait_timeout
    description: Set a new size for a Deployment, ReplicaSet, Replication Controller,
      or Job.
    name: k8s_scale
    outputs:
    - contextPath: Kubernetes.result.api_version
      description: The versioned schema of this representation of an object.
      type: string
    - contextPath: Kubernetes.result.kind
      description: Represents the REST resource this object represents.
      type: string
    - contextPath: Kubernetes.result.metadata
      description: Standard object metadata. Includes name, namespace, annotations,
        labels, etc.
    - contextPath: Kubernetes.result.spec
      description: Specific attributes of the object. Will vary based on the I(api_version)
        and I(kind).
    - contextPath: Kubernetes.result.status
      description: Current status details for the object.
  - arguments:
    - description: 'A partial YAML definition of the Service object being created/updated.
        Here you can define Kubernetes Service Resource parameters not covered by
        this module''s parameters.

        NOTE: `resource_definition` has lower priority than module parameters. If
        you try to define e.g. `metadata.namespace` here, that value will be ignored
        and `metadata` used instead.'
      isArray: true
      name: resource_definition
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: Determines if an object should be created, patched, or deleted.
        When set to `present`, an object will be created, if it does not already exist.
        If set to `absent`, an existing object will be deleted. If set to `present`,
        an existing object will be patched, if its attributes differ from those specified
        using module options and `resource_definition`.
      name: state
      predefined:
      - present
      - absent
    - default: true
      defaultValue: 'False'
      description: If set to `True`, and `state` is `present`, an existing object
        will be replaced.
      name: force
    - auto: PREDEFINED
      description: 'Whether to override the default patch merge approach with a specific
        type. By default, the strategic merge will typically be used.

        For example, Custom Resource Definitions typically aren''t updatable by the
        usual strategic merge. You may want to use `merge` if you see "strategic merge
        patch format is not supported"

        See `https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/#use-a-json-merge-patch-to-update-a-deployment`

        Requires openshift >= 0.6.2

        If more than one merge_type is given, the merge_types will be tried in order

        If openshift >= 0.6.2, this defaults to `[''strategic-merge'', ''merge'']`,
        which is ideal for using the same parameters on resource kinds that combine
        Custom Resources and built-in resources. For openshift < 0.6.2, the default
        is simply `strategic-merge`.'
      isArray: true
      name: merge_type
      predefined:
      - json
      - merge
      - strategic-merge
    - description: Use to specify a Service object name.
      name: name
      required: true
    - description: Use to specify a Service object namespace.
      name: namespace
      required: true
    - auto: PREDEFINED
      description: 'Specifies the type of Service to create.

        See `https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types`'
      name: type
      predefined:
      - NodePort
      - ClusterIP
      - LoadBalancer
      - ExternalName
    - description: 'A list of ports to expose.

        `https://kubernetes.io/docs/concepts/services-networking/service/#multi-port-services`'
      isArray: true
      name: ports
    - description: 'Label selectors identify objects this Service should apply to.

        `https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/`'
      isArray: true
      name: selector
    - description: Token used to authenticate with the API. Can also be specified
        via K8S_AUTH_API_KEY environment variable.
      name: api_key
    - description: Path to an existing Kubernetes config file. If not provided, and
        no other connection options are provided, the openshift client will attempt
        to load the default configuration file from `~/.kube/config.json`. Can also
        be specified via K8S_AUTH_KUBECONFIG environment variable.
      name: kubeconfig
    - description: The name of a context found in the config file. Can also be specified
        via K8S_AUTH_CONTEXT environment variable.
      name: context
    description: Manage Services on Kubernetes
    name: k8s_service
    outputs:
    - contextPath: Kubernetes.result.api_version
      description: The versioned schema of this representation of an object.
      type: string
    - contextPath: Kubernetes.result.kind
      description: Always 'Service'.
      type: string
    - contextPath: Kubernetes.result.metadata
      description: Standard object metadata. Includes name, namespace, annotations,
        labels, etc.
    - contextPath: Kubernetes.result.spec
      description: Specific attributes of the object. Will vary based on the I(api_version)
        and I(kind).
    - contextPath: Kubernetes.result.status
      description: Current status details for the object.
  dockerimage: demisto/ansible-runner
  runonce: false
  script: "\nimport json\nimport traceback\nimport ansible_runner\nimport ssh_agent_setup\n\
    from typing import Any, Dict, Tuple, List, Optional, Union, cast\n\n\n# Dict to\
    \ Markdown Converter adapted from https://github.com/PolBaladas/torsimany/\ndef\
    \ dict2md(json_block, depth=0):\n\tmarkdown = \"\"\n\tif isinstance(json_block,\
    \ dict):\n\t    markdown = parseDict(json_block, depth)\n    if isinstance(json_block,\
    \ list):\n\t    markdown = parseList(json_block, depth)\n\treturn markdown\n\n\
    \ndef parseDict(d, depth):\n\tmarkdown = \"\"\n\tfor k in d:\n\t\tif isinstance(d[k],\
    \ (dict, list)):\n\t\t\tmarkdown += addHeader(k, depth)\n\t\t\tmarkdown += dict2md(d[k],\
    \ depth + 1)\n\t\telse:\n\t\t\tmarkdown += buildValueChain(k, d[k], depth)\n\t\
    return markdown\n\ndef parseList(l, depth):\n\tmarkdown = \"\"\n\tfor value in\
    \ l:\n\t\tif not isinstance(value, (dict, list)):\n\t\t\tindex = l.index(value)\n\
    \t\t\tmarkdown += buildValueChain(index, value, depth)\n\t\telse:\n\t\t\tmarkdown\
    \ += parseDict(value, depth)\n\treturn markdown\n\ndef buildHeaderChain(depth):\n\
    \tlist_tag = '* '\n\thtag = '#'\n\n\tchain = list_tag * (bool(depth)) + htag *\
    \ (depth + 1) + \\\n\t\t' value ' + (htag * (depth + 1) + '\\n')\n\treturn chain\n\
    \ndef buildValueChain(key, value, depth):\n\ttab = \"  \"\n\tlist_tag = '* '\n\
    \n\tchain = tab * (bool(depth - 1)) + list_tag + \\\n\t\tstr(key) + \": \" + str(value)\
    \ + \"\\n\"\n\treturn chain\n\ndef addHeader(value, depth):\n\tchain = buildHeaderChain(depth)\n\
    \tchain = chain.replace('value', value.title())\n\treturn chain\n\n\n# Remove\
    \ ansible branding from results\ndef rec_ansible_key_strip(obj):\n    if isinstance(obj,\
    \ dict):\n        return {key.replace('ansible_', ''): rec_ansible_key_strip(val)\
    \ for key, val in obj.items()}\n    return obj\n\n\n\n# COMMAND FUNCTIONS\n\n\n\
    def generic_ansible(integration_name, command, args: Dict[str, Any]) -> CommandResults:\n\
    \n    readable_output = \"\"\n    sshkey = \"\" \n    fork_count = 1   # default\
    \ to executing against 1 host at a time\n\n    if args.get('concurrency'):\n \
    \       fork_count = int(args.get('concurrency'))\n\n    inventory = {}\n    inventory['all']\
    \ = {}\n    inventory['all']['hosts'] = {}\n    \n    inventory['all']['hosts']['localhost']\
    \ = {}\n    inventory['all']['hosts']['localhost']['ansible_connection'] = 'local'\n\
    \            \n    module_args = \"\"\n    # build module args list\n    for arg_key,\
    \ arg_value in args.items():\n        # skip hardcoded host arg, as it doesn't\
    \ related to module\n        if arg_key == 'host':\n            continue\n\n \
    \       module_args += \"%s=\\\"%s\\\" \" % (arg_key, arg_value)\n    # If this\
    \ isn't host based, then all the integratation parms will be used as command args\n\
    \    for arg_key, arg_value in demisto.params().items():\n        module_args\
    \ += \"%s=\\\"%s\\\" \" % (arg_key, arg_value)\n\n        \n\n    r = ansible_runner.run(inventory=inventory,host_pattern='all',\
    \ module=command, quiet=True, omit_event_data=True, ssh_key=sshkey, module_args=module_args,\
    \ forks=fork_count)\n\n    results = []\n    for each_host_event in r.events:\n\
    \        # Troubleshooting\n        # demisto.log(\"%s: %s\\n\" % (each_host_event['event'],\
    \ each_host_event))\n        if each_host_event['event'] in (\"runner_on_ok\"\
    , \"runner_on_unreachable\", \"runner_on_failed\"):\n\n            # parse results\n\
    \n            result = json.loads('{' + each_host_event['stdout'].split('{',1)[1])\n\
    \            host = each_host_event['stdout'].split('|',1)[0].strip()\n      \
    \      status = each_host_event['stdout'].replace('=>', '|').split('|',3)[1]\n\
    \n            # if successful build outputs\n            if each_host_event['event']\
    \ == \"runner_on_ok\":\n                if 'fact' in command:\n              \
    \      result = result['ansible_facts']\n                else:\n             \
    \       if result.get(command) != None:\n                        result = result[command]\n\
    \                    else:\n                        result.pop(\"ansible_facts\"\
    , None)\n\n                result = rec_ansible_key_strip(result)\n\n        \
    \        if host != \"localhost\":\n                    readable_output += \"\
    # %s - %s\\n\" % (host, status)\n                else:\n                    #\
    \ This is integration is not host based\n                    readable_output +=\
    \ \"# %s\\n\" % status\n\n                readable_output += dict2md(result)\n\
    \n                # add host and status to result\n                result['host']\
    \ = host\n                result['status'] = status\n\n                results.append(result)\n\
    \            if each_host_event['event'] == \"runner_on_unreachable\":\n     \
    \           msg = \"Host %s unreachable\\nError Details: %s\" % (host, result)\n\
    \                return_error(msg)\n\n            if each_host_event['event']\
    \ == \"runner_on_failed\":\n                msg = \"Host %s failed running command\\\
    nError Details: %s\" % (host, result)\n                return_error(msg)\n   \
    \ # This is integration is not host based and always runs against localhost\n\
    \    results = results['localhost']\n    \n    return CommandResults(\n      \
    \  readable_output=readable_output,\n        outputs_prefix=integration_name +\
    \ '.' + command,\n        outputs_key_field='',\n        outputs=results\n   \
    \ )\n\n\n\n# MAIN FUNCTION\n\n\ndef main() -> None:\n    \"\"\"main function,\
    \ parses params and runs command functions\n\n    :return:\n    :rtype:\n    \"\
    \"\"\n\n    # SSH Key integration requires ssh_agent to be running in the background\n\
    \    ssh_agent_setup.setup()\n\n    try:\n\n        if demisto.command() == 'test-module':\n\
    \            # This is the call made when pressing the integration Test button.\n\
    \            return_results('ok')\n        elif demisto.command() == 'k8s_k8s':\n\
    \            return_results(generic_ansible('kubernetes', 'k8s', demisto.args()))\n\
    \        elif demisto.command() == 'k8s_info':\n            return_results(generic_ansible('kubernetes',\
    \ 'k8s_info', demisto.args()))\n        elif demisto.command() == 'k8s_scale':\n\
    \            return_results(generic_ansible('kubernetes', 'k8s_scale', demisto.args()))\n\
    \        elif demisto.command() == 'k8s_service':\n            return_results(generic_ansible('kubernetes',\
    \ 'k8s_service', demisto.args()))\n    # Log exceptions and return errors\n  \
    \  except Exception as e:\n        demisto.error(traceback.format_exc())  # print\
    \ the traceback\n        return_error(f'Failed to execute {demisto.command()}\
    \ command.\\nError:\\n{str(e)}')\n\n\n# ENTRY POINT\n\n\nif __name__ in ('__main__',\
    \ '__builtin__', 'builtins'):\n    main() "
  subtype: python3
  type: python
