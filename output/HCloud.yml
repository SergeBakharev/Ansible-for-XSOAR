category: IT Services
commonfields:
  id: HCloud
  version: -1
configuration:
- additionalinfo: This is the API Token for the Hetzner Cloud.
  display: API Token
  name: api_token
  required: true
  type: 4
- additionalinfo: This is the API Endpoint for the Hetzner Cloud.
  defaultvalue: https://api.hetzner.cloud/v1
  display: Endpoint
  name: endpoint
  required: true
  type: 0
description: Manage your Hetzner Cloud environment
display: HCloud
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAyCAYAAACXpx/YAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAPGSURBVHhe7Zw7aBRBGMc38UVMEI3vxreFkPgARSwELUQLmxRqI2KKFIqldmITS0HxjQoiNoIS0hjEUrRQtEpEC6NgUCMiCopJjBr//53ZY25v9/b2HvG8+//gz/fN3Ow3e/PtzM5tljRMTEx4onZptFYIIYQQQgghhBBCCCGEEEIIIYQQ/xEN1noDTe0LYT5ArBtqG+lfwvo40H4UZgY0BrWg/S/U7YLfB2XiFsggjl9FBzGuwxykn5LbiLGXDmIMwqygn5JDiHGZDmLwe02nn8Bn6CR0Fsf+8WsAjp8KMwLRpmEcmoVYo4ixCf4Tvzae7xBz0Q8dw3HPWBngvtExEwoSs8jafDC5gW0yrrcRSptcstRassXatLRZS4pJLtlgLSkkuWQudBpiQqb5NYYpUNrkEsaYbVxvjbX5aIHmQduhpziH+6wMqJZXdtwXw4p9SawcL5cNWVsMTMywcUumlO+yA0nutH5FE/wCml+gOAsC1kJRbVy4dIU/d2cfr+rw567WQZnl1PIAyxuX2ig2Q+EYC6Bt0FsooBWDG3drCx8fK5zHR9gwLyG3Hces2aoVci/OU9Zm3YOXw7w2JW8cneRdotDevcp4z/iGuuPwu02V1486JqsshPpbidjBuaYCcZbBvDGlDHcQb4/1fUL9rcbnr6yfA9ryYgnGcjfa3kUdb128N/qgLvWtCzEOwNwwJW8AMdqtnwPa0gTnTNuI9vX1ViUGgff38IXRiYHISm4RuEuzex+eTCInU9wMTkvUDC6IQq9sxC5pBuP4DpgeU8qwFXEeWj+LUH9JM/g9zGJT8jrQthd1WTO4EMJjgRjuDP4C9Ro3B15U+43r8wmxeAupjxmMgeqCcZP7E2qOS26VMgfi5ilKbnJ5YXJH7ROXYDZ6lKAkePUOJOgmVFGQ3DMwV0zJ5wfE3+20k0nU93f1GCqVdxBX0+emWOObLBxzC2afKflwINfj2N+mGE+ov5KXaNSVusnixvCocf2+zhs3w2H0ccn6GWp2icbg8H7lJrcPA9AOJSa3SvmKc++xuoAyfx7xaVvARXznnCeAlZzBaRjG8cEMiCTUX94ZjLb3YHaaUiq6EfcEnVB/k7LJsrDfJsQYQ4zEn0low/2Eu3PvQrtr1q+aGcxHbeWkmOQSPo//13DScUNVKHzI4T60uYqkH7F+3k1WGoL2xS5/afurFOGnWwFJ5+ceV47vEsRw40aeG2Yr/9jAZ9f8I0XAOTv7hRBCCCGEEEIIIYQQQgghhBD1i/6dcI1TF6/N1jNKcE3jeX8BcsVo88WLg/IAAAAASUVORK5CYII=
name: HCloud
script:
  commands:
  - arguments:
    - description: The ID of the datacenter you want to get.
      name: id
    - description: The name of the datacenter you want to get.
      name: name
    description: Gather info about the Hetzner Cloud datacenters.
    name: hcloud_datacenter_info
    outputs:
    - contextPath: HCloud.hcloud_datacenter_info.id
      description: Numeric identifier of the datacenter
      type: number
    - contextPath: HCloud.hcloud_datacenter_info.name
      description: Name of the datacenter
      type: string
    - contextPath: HCloud.hcloud_datacenter_info.description
      description: Detail description of the datacenter
      type: string
    - contextPath: HCloud.hcloud_datacenter_info.location
      description: Name of the location where the datacenter resides in
      type: string
    - contextPath: HCloud.hcloud_datacenter_info.city
      description: City of the location
      type: string
  - arguments:
    - description: The ID of the Floating IP you want to get.
      name: id
    - description: The label selector for the Floating IP you want to get.
      name: label_selector
    description: Gather infos about the Hetzner Cloud Floating IPs.
    name: hcloud_floating_ip_info
    outputs:
    - contextPath: HCloud.hcloud_floating_ip_info.id
      description: Numeric identifier of the Floating IP
      type: number
    - contextPath: HCloud.hcloud_floating_ip_info.description
      description: Description of the Floating IP
      type: string
    - contextPath: HCloud.hcloud_floating_ip_info.ip
      description: IP address of the Floating IP
      type: string
    - contextPath: HCloud.hcloud_floating_ip_info.type
      description: Type of the Floating IP
      type: string
    - contextPath: HCloud.hcloud_floating_ip_info.server
      description: Name of the server where the Floating IP is assigned to.
      type: string
    - contextPath: HCloud.hcloud_floating_ip_info.home_location
      description: Location the Floating IP was created in
      type: string
    - contextPath: HCloud.hcloud_floating_ip_info.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The ID of the image you want to get.
      name: id
    - description: The name of the image you want to get.
      name: name
    - description: The label selector for the images you want to get.
      name: label_selector
    - auto: PREDEFINED
      default: true
      defaultValue: system
      description: The label selector for the images you want to get.
      name: type
      predefined:
      - system
      - snapshot
      - backup
    description: Gather infos about your Hetzner Cloud images.
    name: hcloud_image_info
    outputs:
    - contextPath: HCloud.hcloud_image_info.id
      description: Numeric identifier of the image
      type: number
    - contextPath: HCloud.hcloud_image_info.type
      description: Type of the image
      type: string
    - contextPath: HCloud.hcloud_image_info.status
      description: Status of the image
      type: string
    - contextPath: HCloud.hcloud_image_info.name
      description: Name of the image
      type: string
    - contextPath: HCloud.hcloud_image_info.description
      description: Detail description of the image
      type: string
    - contextPath: HCloud.hcloud_image_info.os_flavor
      description: OS flavor of the image
      type: string
    - contextPath: HCloud.hcloud_image_info.os_version
      description: OS version of the image
      type: string
    - contextPath: HCloud.hcloud_image_info.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The ID of the location you want to get.
      name: id
    - description: The name of the location you want to get.
      name: name
    description: Gather infos about your Hetzner Cloud locations.
    name: hcloud_location_info
    outputs:
    - contextPath: HCloud.hcloud_location_info.id
      description: Numeric identifier of the location
      type: number
    - contextPath: HCloud.hcloud_location_info.name
      description: Name of the location
      type: string
    - contextPath: HCloud.hcloud_location_info.description
      description: Detail description of the location
      type: string
    - contextPath: HCloud.hcloud_location_info.country
      description: Country code of the location
      type: string
    - contextPath: HCloud.hcloud_location_info.city
      description: City of the location
      type: string
  - arguments:
    - description: 'The ID of the Hetzner Cloud Networks to manage.

        Only required if no Network `name` is given.'
      name: id
    - description: 'The Name of the Hetzner Cloud Network to manage.

        Only required if no Network `id` is given or a Network does not exists.'
      name: name
    - description: 'IP range of the Network.

        Required if Network does not exists.'
      name: ip_range
    - description: User-defined labels (key-value pairs).
      isArray: true
      name: labels
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the Network.
      name: state
      predefined:
      - absent
      - present
    description: Create and manage cloud Networks on the Hetzner Cloud.
    name: hcloud_network
    outputs:
    - contextPath: HCloud.hcloud_network.id
      description: ID of the Network
      type: number
    - contextPath: HCloud.hcloud_network.name
      description: Name of the Network
      type: string
    - contextPath: HCloud.hcloud_network.ip_range
      description: IP range of the Network
      type: string
    - contextPath: HCloud.hcloud_network.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The ID of the network you want to get.
      name: id
    - description: The name of the network you want to get.
      name: name
    - description: The label selector for the network you want to get.
      name: label_selector
    description: Gather info about your Hetzner Cloud networks.
    name: hcloud_network_info
    outputs:
    - contextPath: HCloud.hcloud_network_info.id
      description: Numeric identifier of the network
      type: number
    - contextPath: HCloud.hcloud_network_info.name
      description: Name of the network
      type: string
    - contextPath: HCloud.hcloud_network_info.ip_range
      description: IP range of the network
      type: string
    - contextPath: HCloud.hcloud_network_info.subnetworks
      description: Subnetworks belonging to the network
    - contextPath: HCloud.hcloud_network_info.routes
      description: Routes belonging to the network
    - contextPath: HCloud.hcloud_network_info.servers
      description: Servers attached to the network
    - contextPath: HCloud.hcloud_network_info.labels
      description: Labels of the network
  - arguments:
    - description: The name of the Hetzner Cloud server you want to add the reverse
        DNS entry to.
      name: server
      required: true
    - description: The IP address that should point to `dns_ptr`.
      name: ip_address
      required: true
    - description: 'The DNS address the `ip_address` should resolve to.

        Omit the param to reset the reverse DNS entry to the default value.'
      name: dns_ptr
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the reverse DNS entry.
      name: state
      predefined:
      - absent
      - present
    description: Create and manage reverse DNS entries on the Hetzner Cloud.
    name: hcloud_rdns
    outputs:
    - contextPath: HCloud.hcloud_rdns.server
      description: Name of the server
      type: string
    - contextPath: HCloud.hcloud_rdns.ip_address
      description: The IP address that point to the DNS ptr
      type: string
    - contextPath: HCloud.hcloud_rdns.dns_ptr
      description: The DNS that resolves to the IP
      type: string
  - arguments:
    - description: The name of the Hetzner Cloud Network.
      name: network
      required: true
    - description: Destination network or host of this route.
      name: destination
      required: true
    - description: Gateway for the route.
      name: gateway
      required: true
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the route.
      name: state
      predefined:
      - absent
      - present
    description: Create and delete cloud routes on the Hetzner Cloud.
    name: hcloud_route
    outputs:
    - contextPath: HCloud.hcloud_route.network
      description: Name of the Network
      type: string
    - contextPath: HCloud.hcloud_route.destination
      description: Destination network or host of this route
      type: string
    - contextPath: HCloud.hcloud_route.gateway
      description: Gateway of the route
      type: string
  - arguments:
    - description: 'The ID of the Hetzner Cloud server to manage.

        Only required if no server `name` is given'
      name: id
    - description: 'The Name of the Hetzner Cloud server to manage.

        Only required if no server `id` is given or a server does not exists.'
      name: name
    - description: 'The Server Type of the Hetzner Cloud server to manage.

        Required if server does not exists.'
      name: server_type
    - description: 'List of SSH key names

        The key names correspond to the SSH keys configured for your Hetzner Cloud
        account access.'
      isArray: true
      name: ssh_keys
    - description: List of Volumes IDs that should be attached to the server on server
        creation.
      isArray: true
      name: volumes
    - description: 'Image the server should be created from.

        Required if server does not exists.'
      name: image
    - description: 'Location of Server.

        Required if no `datacenter` is given and server does not exists.'
      name: location
    - description: 'Datacenter of Server.

        Required of no `location` is given and server does not exists.'
      name: datacenter
    - default: true
      defaultValue: 'False'
      description: Enable or disable Backups for the given Server.
      name: backups
    - default: true
      defaultValue: 'False'
      description: 'Resize the disk size, when resizing a server.

        If you want to downgrade the server later, this value should be False.'
      name: upgrade_disk
    - default: true
      defaultValue: 'False'
      description: 'Force the upgrade of the server.

        Power off the server if it is running on upgrade.'
      name: force_upgrade
    - description: 'User Data to be passed to the server on creation.

        Only used if server does not exists.'
      name: user_data
    - description: Add the Hetzner rescue system type you want the server to be booted
        into.
      name: rescue_mode
    - description: User-defined labels (key-value pairs).
      isArray: true
      name: labels
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the server.
      name: state
      predefined:
      - absent
      - present
      - restarted
      - started
      - stopped
      - rebuild
    description: Create and manage cloud servers on the Hetzner Cloud.
    name: hcloud_server
    outputs:
    - contextPath: HCloud.hcloud_server.id
      description: Numeric identifier of the server
      type: number
    - contextPath: HCloud.hcloud_server.name
      description: Name of the server
      type: string
    - contextPath: HCloud.hcloud_server.status
      description: Status of the server
      type: string
    - contextPath: HCloud.hcloud_server.server_type
      description: Name of the server type of the server
      type: string
    - contextPath: HCloud.hcloud_server.ipv4_address
      description: Public IPv4 address of the server
      type: string
    - contextPath: HCloud.hcloud_server.ipv6
      description: IPv6 network of the server
      type: string
    - contextPath: HCloud.hcloud_server.location
      description: Name of the location of the server
      type: string
    - contextPath: HCloud.hcloud_server.datacenter
      description: Name of the datacenter of the server
      type: string
    - contextPath: HCloud.hcloud_server.rescue_enabled
      description: True if rescue mode is enabled, Server will then boot into rescue
        system on next reboot
      type: boolean
    - contextPath: HCloud.hcloud_server.backup_window
      description: Time window (UTC) in which the backup will run, or null if the
        backups are not enabled
      type: boolean
    - contextPath: HCloud.hcloud_server.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The ID of the server you want to get.
      name: id
    - description: The name of the server you want to get.
      name: name
    - description: The label selector for the server you want to get.
      name: label_selector
    description: Gather infos about your Hetzner Cloud servers.
    name: hcloud_server_info
    outputs:
    - contextPath: HCloud.hcloud_server_info.id
      description: Numeric identifier of the server
      type: number
    - contextPath: HCloud.hcloud_server_info.name
      description: Name of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.status
      description: Status of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.server_type
      description: Name of the server type of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.ipv4_address
      description: Public IPv4 address of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.ipv6
      description: IPv6 network of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.location
      description: Name of the location of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.datacenter
      description: Name of the datacenter of the server
      type: string
    - contextPath: HCloud.hcloud_server_info.rescue_enabled
      description: True if rescue mode is enabled, Server will then boot into rescue
        system on next reboot
      type: boolean
    - contextPath: HCloud.hcloud_server_info.backup_window
      description: Time window (UTC) in which the backup will run, or null if the
        backups are not enabled
      type: boolean
    - contextPath: HCloud.hcloud_server_info.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The name of the Hetzner Cloud Networks.
      name: network
      required: true
    - description: The name of the Hetzner Cloud server.
      name: server
      required: true
    - description: The IP the server should have.
      name: ip
    - description: Alias IPs the server has.
      isArray: true
      name: alias_ips
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the server_network.
      name: state
      predefined:
      - absent
      - present
    description: Manage the relationship between Hetzner Cloud Networks and servers
    name: hcloud_server_network
    outputs:
    - contextPath: HCloud.hcloud_server_network.network
      description: Name of the Network
      type: string
    - contextPath: HCloud.hcloud_server_network.server
      description: Name of the server
      type: string
    - contextPath: HCloud.hcloud_server_network.ip
      description: IP of the server within the Network ip range
      type: string
    - contextPath: HCloud.hcloud_server_network.alias_ips
      description: Alias IPs of the server within the Network ip range
      type: string
  - arguments:
    - description: The ID of the server type you want to get.
      name: id
    - description: The name of the server type you want to get.
      name: name
    description: Gather infos about the Hetzner Cloud server types.
    name: hcloud_server_type_info
    outputs:
    - contextPath: HCloud.hcloud_server_type_info.id
      description: Numeric identifier of the server type
      type: number
    - contextPath: HCloud.hcloud_server_type_info.name
      description: Name of the server type
      type: string
    - contextPath: HCloud.hcloud_server_type_info.description
      description: Detail description of the server type
      type: string
    - contextPath: HCloud.hcloud_server_type_info.cores
      description: Number of cpu cores a server of this type will have
      type: number
    - contextPath: HCloud.hcloud_server_type_info.memory
      description: Memory a server of this type will have in GB
      type: number
    - contextPath: HCloud.hcloud_server_type_info.disk
      description: Disk size a server of this type will have in GB
      type: number
    - contextPath: HCloud.hcloud_server_type_info.storage_type
      description: Type of server boot drive
      type: string
    - contextPath: HCloud.hcloud_server_type_info.cpu_type
      description: Type of cpu
      type: string
  - arguments:
    - description: 'The ID of the Hetzner Cloud ssh_key to manage.

        Only required if no ssh_key `name` is given'
      name: id
    - description: 'The Name of the Hetzner Cloud ssh_key to manage.

        Only required if no ssh_key `id` is given or a ssh_key does not exists.'
      name: name
    - description: 'The Fingerprint of the Hetzner Cloud ssh_key to manage.

        Only required if no ssh_key `id` or `name` is given.'
      name: fingerprint
    - description: User-defined labels (key-value pairs)
      isArray: true
      name: labels
    - description: 'The Public Key to add.

        Required if ssh_key does not exists.'
      name: public_key
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the ssh_key.
      name: state
      predefined:
      - absent
      - present
    description: Create and manage ssh keys on the Hetzner Cloud.
    name: hcloud_ssh_key
    outputs:
    - contextPath: HCloud.hcloud_ssh_key.id
      description: ID of the ssh_key
      type: number
    - contextPath: HCloud.hcloud_ssh_key.name
      description: Name of the ssh_key
      type: string
    - contextPath: HCloud.hcloud_ssh_key.fingerprint
      description: Fingerprint of the ssh_key
      type: string
    - contextPath: HCloud.hcloud_ssh_key.public_key
      description: Public key of the ssh_key
      type: string
    - contextPath: HCloud.hcloud_ssh_key.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The ID of the ssh key you want to get.
      name: id
    - description: The name of the ssh key you want to get.
      name: name
    - description: The fingerprint of the ssh key you want to get.
      name: fingerprint
    - description: The label selector for the ssh key you want to get.
      name: label_selector
    description: Gather infos about your Hetzner Cloud ssh_keys.
    name: hcloud_ssh_key_info
    outputs:
    - contextPath: HCloud.hcloud_ssh_key_info.id
      description: Numeric identifier of the ssh_key
      type: number
    - contextPath: HCloud.hcloud_ssh_key_info.name
      description: Name of the ssh_key
      type: string
    - contextPath: HCloud.hcloud_ssh_key_info.fingerprint
      description: Fingerprint of the ssh key
      type: string
    - contextPath: HCloud.hcloud_ssh_key_info.public_key
      description: The actual public key
      type: string
    - contextPath: HCloud.hcloud_ssh_key_info.labels
      description: User-defined labels (key-value pairs)
  - arguments:
    - description: The ID or Name  of the Hetzner Cloud Networks.
      name: network
      required: true
    - description: IP range of the subnetwork.
      name: ip_range
      required: true
    - description: Type of subnetwork.
      name: type
      required: true
    - description: Name of network zone.
      name: network_zone
      required: true
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the subnetwork.
      name: state
      predefined:
      - absent
      - present
    description: Manage cloud subnetworks on the Hetzner Cloud.
    name: hcloud_subnetwork
    outputs:
    - contextPath: HCloud.hcloud_subnetwork.network
      description: Name of the Network
      type: string
    - contextPath: HCloud.hcloud_subnetwork.ip_range
      description: IP range of the Network
      type: string
    - contextPath: HCloud.hcloud_subnetwork.type
      description: Type of subnetwork
      type: string
    - contextPath: HCloud.hcloud_subnetwork.network_zone
      description: Name of network zone
      type: string
    - contextPath: HCloud.hcloud_subnetwork.gateway
      description: Gateway of the subnetwork
      type: string
  - arguments:
    - description: 'The ID of the Hetzner Cloud Block Volume to manage.

        Only required if no volume `name` is given'
      name: id
    - description: 'The Name of the Hetzner Cloud Block Volume to manage.

        Only required if no volume `id` is given or a volume does not exists.'
      name: name
    - description: 'The size of the Block Volume in GB.

        Required if volume does not yet exists.'
      name: size
    - description: Automatically mount the Volume.
      name: automount
    - auto: PREDEFINED
      description: 'Automatically Format the volume on creation

        Can only be used in case the Volume does not exists.'
      name: format
      predefined:
      - xfs
      - ext4
    - description: 'Location of the Hetzner Cloud Volume.

        Required if no `server` is given and Volume does not exists.'
      name: location
    - description: 'Server Name the Volume should be assigned to.

        Required if no `location` is given and Volume does not exists.'
      name: server
    - description: User-defined key-value pairs.
      isArray: true
      name: labels
    - auto: PREDEFINED
      default: true
      defaultValue: present
      description: State of the volume.
      name: state
      predefined:
      - absent
      - present
    description: Create and manage block volumes on the Hetzner Cloud.
    name: hcloud_volume
    outputs:
    - contextPath: HCloud.hcloud_volume.id
      description: ID of the volume
      type: number
    - contextPath: HCloud.hcloud_volume.name
      description: Name of the volume
      type: string
    - contextPath: HCloud.hcloud_volume.size
      description: Size in GB of the volume
      type: number
    - contextPath: HCloud.hcloud_volume.location
      description: Location name where the volume is located at
      type: string
    - contextPath: HCloud.hcloud_volume.labels
      description: User-defined labels (key-value pairs)
    - contextPath: HCloud.hcloud_volume.server
      description: Server name where the volume is attached to
      type: string
  - arguments:
    - description: The ID of the volume you want to get.
      name: id
    - description: The name of the volume you want to get.
      name: name
    - description: The label selector for the volume you want to get.
      name: label_selector
    description: Gather infos about your Hetzner Cloud volumes.
    name: hcloud_volume_info
    outputs:
    - contextPath: HCloud.hcloud_volume_info.id
      description: Numeric identifier of the volume
      type: number
    - contextPath: HCloud.hcloud_volume_info.name
      description: Name of the volume
      type: string
    - contextPath: HCloud.hcloud_volume_info.size
      description: Size of the volume
      type: string
    - contextPath: HCloud.hcloud_volume_info.location
      description: Name of the location where the volume resides in
      type: string
    - contextPath: HCloud.hcloud_volume_info.server
      description: Name of the server where the volume is attached to
      type: string
    - contextPath: HCloud.hcloud_volume_info.labels
      description: User-defined labels (key-value pairs)
  dockerimage: demisto/ansible-runner
  runonce: false
  script: "\nimport json\nimport traceback\nimport ansible_runner\nimport ssh_agent_setup\n\
    from typing import Any, Dict, Tuple, List, Optional, Union, cast\n\n\n# Dict to\
    \ Markdown Converter adapted from https://github.com/PolBaladas/torsimany/\ndef\
    \ dict2md(json_block, depth=0):\n\tmarkdown = \"\"\n\tif isinstance(json_block,\
    \ dict):\n\t    markdown = parseDict(json_block, depth)\n    if isinstance(json_block,\
    \ list):\n\t    markdown = parseList(json_block, depth)\n\treturn markdown\n\n\
    \ndef parseDict(d, depth):\n\tmarkdown = \"\"\n\tfor k in d:\n\t\tif isinstance(d[k],\
    \ (dict, list)):\n\t\t\tmarkdown += addHeader(k, depth)\n\t\t\tmarkdown += dict2md(d[k],\
    \ depth + 1)\n\t\telse:\n\t\t\tmarkdown += buildValueChain(k, d[k], depth)\n\t\
    return markdown\n\ndef parseList(l, depth):\n\tmarkdown = \"\"\n\tfor value in\
    \ l:\n\t\tif not isinstance(value, (dict, list)):\n\t\t\tindex = l.index(value)\n\
    \t\t\tmarkdown += buildValueChain(index, value, depth)\n\t\telse:\n\t\t\tmarkdown\
    \ += parseDict(value, depth)\n\treturn markdown\n\ndef buildHeaderChain(depth):\n\
    \tlist_tag = '* '\n\thtag = '#'\n\n\tchain = list_tag * (bool(depth)) + htag *\
    \ (depth + 1) + \\\n\t\t' value ' + (htag * (depth + 1) + '\\n')\n\treturn chain\n\
    \ndef buildValueChain(key, value, depth):\n\ttab = \"  \"\n\tlist_tag = '* '\n\
    \n\tchain = tab * (bool(depth - 1)) + list_tag + \\\n\t\tstr(key) + \": \" + str(value)\
    \ + \"\\n\"\n\treturn chain\n\ndef addHeader(value, depth):\n\tchain = buildHeaderChain(depth)\n\
    \tchain = chain.replace('value', value.title())\n\treturn chain\n\n\n# Remove\
    \ ansible branding from results\ndef rec_ansible_key_strip(obj):\n    if isinstance(obj,\
    \ dict):\n        return {key.replace('ansible_', ''): rec_ansible_key_strip(val)\
    \ for key, val in obj.items()}\n    return obj\n\n\n\n# COMMAND FUNCTIONS\n\n\n\
    def generic_ansible(integration_name, command, args: Dict[str, Any]) -> CommandResults:\n\
    \n    readable_output = \"\"\n    sshkey = \"\" \n    fork_count = 1   # default\
    \ to executing against 1 host at a time\n\n    if args.get('concurrency'):\n \
    \       fork_count = int(args.get('concurrency'))\n\n    inventory = {}\n    inventory['all']\
    \ = {}\n    inventory['all']['hosts'] = {}\n    \n    inventory['all']['hosts']['localhost']\
    \ = {}\n    inventory['all']['hosts']['localhost']['ansible_connection'] = 'local'\n\
    \            \n    module_args = \"\"\n    # build module args list\n    for arg_key,\
    \ arg_value in args.items():\n        # skip hardcoded host arg, as it doesn't\
    \ related to module\n        if arg_key == 'host':\n            continue\n\n \
    \       module_args += \"%s=\\\"%s\\\" \" % (arg_key, arg_value)\n    # If this\
    \ isn't host based, then all the integratation parms will be used as command args\n\
    \    for arg_key, arg_value in demisto.params().items():\n        module_args\
    \ += \"%s=\\\"%s\\\" \" % (arg_key, arg_value)\n\n        \n\n    r = ansible_runner.run(inventory=inventory,host_pattern='all',\
    \ module=command, quiet=True, omit_event_data=True, ssh_key=sshkey, module_args=module_args,\
    \ forks=fork_count)\n\n    results = []\n    for each_host_event in r.events:\n\
    \        # Troubleshooting\n        # demisto.log(\"%s: %s\\n\" % (each_host_event['event'],\
    \ each_host_event))\n        if each_host_event['event'] in (\"runner_on_ok\"\
    , \"runner_on_unreachable\", \"runner_on_failed\"):\n\n            # parse results\n\
    \n            result = json.loads('{' + each_host_event['stdout'].split('{',1)[1])\n\
    \            host = each_host_event['stdout'].split('|',1)[0].strip()\n      \
    \      status = each_host_event['stdout'].replace('=>', '|').split('|',3)[1]\n\
    \n            # if successful build outputs\n            if each_host_event['event']\
    \ == \"runner_on_ok\":\n                if 'fact' in command:\n              \
    \      result = result['ansible_facts']\n                else:\n             \
    \       if result.get(command) != None:\n                        result = result[command]\n\
    \                    else:\n                        result.pop(\"ansible_facts\"\
    , None)\n\n                result = rec_ansible_key_strip(result)\n\n        \
    \        if host != \"localhost\":\n                    readable_output += \"\
    # %s - %s\\n\" % (host, status)\n                else:\n                    #\
    \ This is integration is not host based\n                    readable_output +=\
    \ \"# %s\\n\" % status\n\n                readable_output += dict2md(result)\n\
    \n                # add host and status to result\n                result['host']\
    \ = host\n                result['status'] = status\n\n                results.append(result)\n\
    \            if each_host_event['event'] == \"runner_on_unreachable\":\n     \
    \           msg = \"Host %s unreachable\\nError Details: %s\" % (host, result)\n\
    \                return_error(msg)\n\n            if each_host_event['event']\
    \ == \"runner_on_failed\":\n                msg = \"Host %s failed running command\\\
    nError Details: %s\" % (host, result)\n                return_error(msg)\n   \
    \ # This is integration is not host based and always runs against localhost\n\
    \    results = results['localhost']\n    \n    return CommandResults(\n      \
    \  readable_output=readable_output,\n        outputs_prefix=integration_name +\
    \ '.' + command,\n        outputs_key_field='',\n        outputs=results\n   \
    \ )\n\n\n\n# MAIN FUNCTION\n\n\ndef main() -> None:\n    \"\"\"main function,\
    \ parses params and runs command functions\n\n    :return:\n    :rtype:\n    \"\
    \"\"\n\n    # SSH Key integration requires ssh_agent to be running in the background\n\
    \    ssh_agent_setup.setup()\n\n    try:\n\n        if demisto.command() == 'test-module':\n\
    \            # This is the call made when pressing the integration Test button.\n\
    \            return_results('ok')\n        elif demisto.command() == 'hcloud_datacenter_info':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_datacenter_info',\
    \ demisto.args()))\n        elif demisto.command() == 'hcloud_floating_ip_info':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_floating_ip_info',\
    \ demisto.args()))\n        elif demisto.command() == 'hcloud_image_info':\n \
    \           return_results(generic_ansible('hcloud', 'hcloud_image_info', demisto.args()))\n\
    \        elif demisto.command() == 'hcloud_location_info':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_location_info', demisto.args()))\n        elif demisto.command() ==\
    \ 'hcloud_network':\n            return_results(generic_ansible('hcloud', 'hcloud_network',\
    \ demisto.args()))\n        elif demisto.command() == 'hcloud_network_info':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_network_info', demisto.args()))\n\
    \        elif demisto.command() == 'hcloud_rdns':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_rdns', demisto.args()))\n        elif demisto.command() == 'hcloud_route':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_route', demisto.args()))\n\
    \        elif demisto.command() == 'hcloud_server':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_server', demisto.args()))\n        elif demisto.command() == 'hcloud_server_info':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_server_info', demisto.args()))\n\
    \        elif demisto.command() == 'hcloud_server_network':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_server_network', demisto.args()))\n        elif demisto.command() ==\
    \ 'hcloud_server_type_info':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_server_type_info', demisto.args()))\n        elif demisto.command()\
    \ == 'hcloud_ssh_key':\n            return_results(generic_ansible('hcloud', 'hcloud_ssh_key',\
    \ demisto.args()))\n        elif demisto.command() == 'hcloud_ssh_key_info':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_ssh_key_info', demisto.args()))\n\
    \        elif demisto.command() == 'hcloud_subnetwork':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_subnetwork', demisto.args()))\n        elif demisto.command() == 'hcloud_volume':\n\
    \            return_results(generic_ansible('hcloud', 'hcloud_volume', demisto.args()))\n\
    \        elif demisto.command() == 'hcloud_volume_info':\n            return_results(generic_ansible('hcloud',\
    \ 'hcloud_volume_info', demisto.args()))\n    # Log exceptions and return errors\n\
    \    except Exception as e:\n        demisto.error(traceback.format_exc())  #\
    \ print the traceback\n        return_error(f'Failed to execute {demisto.command()}\
    \ command.\\nError:\\n{str(e)}')\n\n\n# ENTRY POINT\n\n\nif __name__ in ('__main__',\
    \ '__builtin__', 'builtins'):\n    main() "
  subtype: python3
  type: python
